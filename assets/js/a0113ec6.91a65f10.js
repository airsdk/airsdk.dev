"use strict";(self.webpackChunkairsdk_dev=self.webpackChunkairsdk_dev||[]).push([[36261],{18508:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"development/html-content-in-air/programming-html-and-javascript-in-air/cross-scripting-content-in-different-security-sandboxes","title":"Cross-scripting content in different security sandboxes","description":"The runtime security model isolates code from different origins. By","source":"@site/docs/development/html-content-in-air/programming-html-and-javascript-in-air/cross-scripting-content-in-different-security-sandboxes.md","sourceDirName":"development/html-content-in-air/programming-html-and-javascript-in-air","slug":"/development/html-content-in-air/programming-html-and-javascript-in-air/cross-scripting-content-in-different-security-sandboxes","permalink":"/docs/development/html-content-in-air/programming-html-and-javascript-in-air/cross-scripting-content-in-different-security-sandboxes","draft":false,"unlisted":false,"editUrl":"https://github.com/airsdk/airsdk.dev/edit/main/docs/development/html-content-in-air/programming-html-and-javascript-in-air/cross-scripting-content-in-different-security-sandboxes.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Converting Date and RegExp objects","permalink":"/docs/development/html-content-in-air/programming-html-and-javascript-in-air/converting-date-and-regexp-objects"},"next":{"title":"Embedding SWF content in HTML","permalink":"/docs/development/html-content-in-air/programming-html-and-javascript-in-air/embedding-swf-content-in-html"}}');var i=t(74848),a=t(28453);const c={},s="Cross-scripting content in different security sandboxes",r={},d=[{value:"AIR security sandboxes and JavaScript code",id:"air-security-sandboxes-and-javascript-code",level:2},{value:"Loading application content into a non-application sandbox",id:"loading-application-content-into-a-non-application-sandbox",level:2},{value:"Setting up a sandbox bridge interface",id:"setting-up-a-sandbox-bridge-interface",level:2},{value:"Establishing a child sandbox bridge",id:"establishing-a-child-sandbox-bridge",level:2},{value:"Establishing a parent sandbox bridge",id:"establishing-a-parent-sandbox-bridge",level:2},{value:"Accessing a parent sandbox bridge during page loading",id:"accessing-a-parent-sandbox-bridge-during-page-loading",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cross-scripting-content-in-different-security-sandboxes",children:"Cross-scripting content in different security sandboxes"})}),"\n",(0,i.jsx)(n.p,{children:"The runtime security model isolates code from different origins. By\ncross-scripting content in different security sandboxes, you can allow content\nin one security sandbox to access selected properties and methods in another\nsandbox."}),"\n",(0,i.jsx)(n.h2,{id:"air-security-sandboxes-and-javascript-code",children:"AIR security sandboxes and JavaScript code"}),"\n",(0,i.jsx)(n.p,{children:"AIR enforces a same-origin policy that prevents code in one domain from\ninteracting with content in another. All files are placed in a sandbox based on\ntheir origin. Ordinarily, content in the application sandbox cannot violate the\nsame-origin principle and cross-script content loaded from outside the\napplication install directory. However, AIR provides a few techniques that let\nyou cross-script non-application content."}),"\n",(0,i.jsxs)(n.p,{children:["One technique uses frames or iframes to map application content into a different\nsecurity sandbox. Any pages loaded from the sandboxed area of the application\nbehave as if they were loaded from the remote domain. For example, by mapping\napplication content to the ",(0,i.jsx)(n.em,{children:"example.com"})," domain, that content could cross-script\npages loaded from example.com."]}),"\n",(0,i.jsx)(n.p,{children:"Since this technique places the application content into a different sandbox,\ncode within that content is also no longer subject to the restrictions on the\nexecution of code in evaluated strings. You can use this sandbox mapping\ntechnique to ease these restrictions even when you don't need to cross-script\nremote content. Mapping content in this way can be especially useful when\nworking with one of the many JavaScript frameworks or with existing code that\nrelies on evaluating strings. However, you should consider and guard against the\nadditional risk that untrusted content could be injected and executed when\ncontent is run outside the application sandbox."}),"\n",(0,i.jsx)(n.p,{children:"At the same time, application content mapped to another sandbox loses its access\nto the AIR APIs, so the sandbox mapping technique cannot be used to expose AIR\nfunctionality to code executed outside the application sandbox."}),"\n",(0,i.jsxs)(n.p,{children:["Another cross-scripting technique lets you create an interface called a ",(0,i.jsx)(n.em,{children:"sandbox\nbridge"})," between content in a non-application sandbox and its parent document in\nthe application sandbox. The bridge allows the child content to access\nproperties and methods defined by the parent, the parent to access properties\nand methods defined by the child, or both."]}),"\n",(0,i.jsx)(n.p,{children:"Finally, you can also perform cross-domain XMLHttpRequests from the application\nsandbox and, optionally, from other sandboxes."}),"\n",(0,i.jsxs)(n.p,{children:["For more information, see\n",(0,i.jsx)(n.a,{href:"/docs/development/html-content-in-air/about-the-html-environment/html-in-air#html-frame-and-iframe-elements",children:"HTML frame and iframe elements"}),",\n",(0,i.jsx)(n.a,{href:"/docs/development/security/air-security/html-security-in-adobe-air",children:"HTML security in Adobe AIR"}),",\nand\n",(0,i.jsx)(n.a,{href:"/docs/development/html-content-in-air/about-the-html-environment/javascript-in-air#the-xmlhttprequest-object",children:"The XMLHttpRequest object"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"loading-application-content-into-a-non-application-sandbox",children:"Loading application content into a non-application sandbox"}),"\n",(0,i.jsxs)(n.p,{children:["To allow application content to safely cross-script content loaded from outside\nthe application install directory, you can use ",(0,i.jsx)(n.code,{children:"frame"})," or ",(0,i.jsx)(n.code,{children:"iframe"})," elements to\nload application content into the same security sandbox as the external content.\nIf you do not need to cross-script remote content, but still wish to load a page\nof your application outside the application sandbox, you can use the same\ntechnique, specifying ",(0,i.jsx)(n.code,{children:"http://localhost/"})," or some other innocuous value, as the\ndomain of origin."]}),"\n",(0,i.jsxs)(n.p,{children:["AIR adds the new attributes, ",(0,i.jsx)(n.code,{children:"sandboxRoot"})," and ",(0,i.jsx)(n.code,{children:"documentRoot"}),", to the frame\nelement that allow you to specify whether an application file loaded into the\nframe should be mapped to a non-application sandbox. Files resolving to a path\nunderneath the ",(0,i.jsx)(n.code,{children:"sandboxRoot"})," URL are loaded instead from the ",(0,i.jsx)(n.code,{children:"documentRoot"}),"\ndirectory. For security purposes, the application content loaded in this way is\ntreated as if it was actually loaded from the ",(0,i.jsx)(n.code,{children:"sandboxRoot"})," URL."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"sandboxRoot"})," property specifies the URL to use for determining the sandbox\nand domain in which to place the frame content. The ",(0,i.jsx)(n.code,{children:"file:"}),", ",(0,i.jsx)(n.code,{children:"http:"}),", or\n",(0,i.jsx)(n.code,{children:"https:"})," URL schemes must be used. If you specify a relative URL, the content\nremains in the application sandbox."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"documentRoot"})," property specifies the directory from which to load the frame\ncontent. The ",(0,i.jsx)(n.code,{children:"file:"}),", ",(0,i.jsx)(n.code,{children:"app:"}),", or ",(0,i.jsx)(n.code,{children:"app-storage:"})," URL schemes must be used."]}),"\n",(0,i.jsxs)(n.p,{children:["The following example maps content installed in the ",(0,i.jsx)(n.code,{children:"sandbox"})," subdirectory of\nthe application to run in the remote sandbox and the ",(0,i.jsx)(n.code,{children:"www.example.com"})," domain:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'<iframe\n\tsrc="http://www.example.com/local/ui.html"\n\tsandboxRoot="http://www.example.com/local/"\n\tdocumentRoot="app:/sandbox/">\n</iframe>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ui.html"})," page could load a javascript file from the local, ",(0,i.jsx)(n.code,{children:"sandbox"})," folder\nusing the following script tag:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'<script src="http://www.example.com/local/ui.js"><\/script>\n'})}),"\n",(0,i.jsx)(n.p,{children:"It could also load content from a directory on the remote server using a script\ntag such as the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'<script src="http://www.example.com/remote/remote.js"><\/script>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"sandboxRoot"})," URL will mask any content at the same URL on the remote\nserver. In the above example, you would not be able to access any remote content\nat ",(0,i.jsx)(n.code,{children:"www.example.com/local/"})," (or any of its subdirectories) because AIR remaps\nthe request to the local application directory. Requests are remapped whether\nthey derive from page navigation, from an XMLHttpRequest, or from any other\nmeans of loading content."]}),"\n",(0,i.jsx)(n.h2,{id:"setting-up-a-sandbox-bridge-interface",children:"Setting up a sandbox bridge interface"}),"\n",(0,i.jsxs)(n.p,{children:["You can use a sandbox bridge when content in the application sandbox must access\nproperties or methods defined by content in a non-application sandbox, or when\nnon-application content must access properties and methods defined by content in\nthe application sandbox. Create a bridge with the ",(0,i.jsx)(n.code,{children:"childSandboxBridge"})," and\n",(0,i.jsx)(n.code,{children:"parentSandboxBridge"})," properties of the ",(0,i.jsx)(n.code,{children:"window"})," object of any child document."]}),"\n",(0,i.jsx)(n.h2,{id:"establishing-a-child-sandbox-bridge",children:"Establishing a child sandbox bridge"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"childSandboxBridge"})," property allows the child document to expose an\ninterface to content in the parent document. To expose an interface, you set the\n",(0,i.jsx)(n.code,{children:"childSandbox"})," property to a function or object in the child document. You can\nthen access the object or function from content in the parent document. The\nfollowing example shows how a script running in a child document can expose an\nobject containing a function and a property to its parent:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'var interface = {};\ninterface.calculatePrice = function(){\n\treturn ".45 cents";\n}\ninterface.storeID = "abc"\nwindow.childSandboxBridge = interface;\n'})}),"\n",(0,i.jsxs)(n.p,{children:['If this child content was loaded into an iframe assigned an id of "child", you\ncould access the interface from parent content by reading the\n',(0,i.jsx)(n.code,{children:"childSandboxBridge"})," property of the frame:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'var childInterface = document.getElementById("child").contentWindow.childSandboxBridge;\nair.trace(childInterface.calculatePrice()); //traces ".45 cents"\nair.trace(childInterface.storeID)); //traces "abc"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"establishing-a-parent-sandbox-bridge",children:"Establishing a parent sandbox bridge"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"parentSandboxBridge"})," property allows the parent document to expose an\ninterface to content in a child document. To expose an interface, the parent\ndocument sets the ",(0,i.jsx)(n.code,{children:"parentSandbox"})," property of the child document to a function\nor object defined in the parent document. You can then access the object or\nfunction from content in the child. The following example shows how a script\nrunning in a parent frame can expose an object containing a function to a child\ndocument:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'var interface = {};\ninterface.save = function(text){\n\tvar saveFile = air.File("app-storage:/save.txt");\n\t//write text to file\n}\ndocument.getElementById("child").contentWindow.parentSandboxBridge = interface;\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Using this interface, content in the child frame could save text to a file named\n",(0,i.jsx)(n.code,{children:"save.txt"}),", but would not have any other access to the file system. The child\ncontent could call the save function as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'var textToSave = "A string.";\nwindow.parentSandboxBridge.save(textToSave);\n'})}),"\n",(0,i.jsx)(n.p,{children:"Application content should expose the narrowest interface possible to other\nsandboxes. Non-application content should be considered inherently untrustworthy\nsince it may be subject to accidental or malicious code injection. You must put\nappropriate safeguards in place to prevent misuse of the interface you expose\nthrough the parent sandbox bridge."}),"\n",(0,i.jsx)(n.h2,{id:"accessing-a-parent-sandbox-bridge-during-page-loading",children:"Accessing a parent sandbox bridge during page loading"}),"\n",(0,i.jsxs)(n.p,{children:["In order for a script in a child document to access a parent sandbox bridge, the\nbridge must be set up before the script is run. Window, frame and iframe objects\ndispatch a ",(0,i.jsx)(n.code,{children:"dominitialize"})," event when a new page DOM has been created, but\nbefore any scripts have been parsed, or DOM elements added. You can use the\n",(0,i.jsx)(n.code,{children:"dominitialize"})," event to establish the bridge early enough in the page\nconstruction sequence that all scripts in the child document can access it."]}),"\n",(0,i.jsxs)(n.p,{children:["The following example illustrates how to create a parent sandbox bridge in\nresponse to the ",(0,i.jsx)(n.code,{children:"dominitialize"})," event dispatched from the child frame:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'<html>\n<head>\n\t<script>\n\t\tvar bridgeInterface = {};\n\t\tbridgeInterface.testProperty = "Bridge engaged";\n\t\tfunction engageBridge(){\n\t\t\tdocument.getElementById("sandbox").contentWindow.parentSandboxBridge = bridgeInterface;\n\t\t}\n\t<\/script>\n</head>\n<body>\n\t<iframe id="sandbox"\n\t\t\tsrc="http://www.example.com/air/child.html"\n\t\t\tdocumentRoot="app:/"\n\t\t\tsandboxRoot="http://www.example.com/air/"\n\t\t\tondominitialize="engageBridge()"/>\n</body>\n</html>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The following ",(0,i.jsx)(n.code,{children:"child.html"})," document illustrates how child content can access the\nparent sandbox bridge:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"<html>\n<head>\n"})}),"\n",(0,i.jsx)("script",{children:(0,i.jsx)(n.p,{children:"document.write(window.parentSandboxBridge.testProperty);"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"</head>\n<body></body>\n</html>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To listen for the ",(0,i.jsx)(n.code,{children:"dominitialize"})," event on a child window, rather than a frame,\nyou must add the listener to the new child window object created by the\n",(0,i.jsx)(n.code,{children:"window.open()"})," function:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'var childWindow = window.open();\nchildWindow.addEventListener("dominitialize", engageBridge());\nchildWindow.document.location = "http://www.example.com/air/child.html";\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In this case, there is no way to map application content into a non-application\nsandbox. This technique is only useful when ",(0,i.jsx)(n.code,{children:"child.html"})," is loaded from outside\nthe application directory. You can still map application content in the window\nto a non-application sandbox, but you must first load an intermediate page that\nitself uses frames to load the child document and map it to the desired sandbox."]}),"\n",(0,i.jsxs)(n.p,{children:["If you use the HTMLLoader class ",(0,i.jsx)(n.code,{children:"createRootWindow()"})," function to create a\nwindow, the new window is not a child of the document from which\n",(0,i.jsx)(n.code,{children:"createRootWindow()"})," is called. Thus, you cannot create a sandbox bridge from\nthe calling window to non-application content loaded into the new window.\nInstead, you must use load an intermediate page in the new window that itself\nuses frames to load the child document. You can then establish the bridge from\nthe parent document of the new window to the child document loaded into the\nframe."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>s});var o=t(96540);const i={},a=o.createContext(i);function c(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);