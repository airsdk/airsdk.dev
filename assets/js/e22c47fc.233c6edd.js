"use strict";(self.webpackChunkairsdk_dev=self.webpackChunkairsdk_dev||[]).push([[31981],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>d});var i=n(96540);const o={},a=i.createContext(o);function s(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:t},e.children)}},60796:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"development/rich-media-content/working-with-video/using-the-stagevideo-apis","title":"Using the StageVideo APIs","description":"Stage video is a mechanism within the runtime that enhances video playback and","source":"@site/docs/development/rich-media-content/working-with-video/using-the-stagevideo-apis.md","sourceDirName":"development/rich-media-content/working-with-video","slug":"/development/rich-media-content/working-with-video/using-the-stagevideo-apis","permalink":"/docs/development/rich-media-content/working-with-video/using-the-stagevideo-apis","draft":false,"unlisted":false,"editUrl":"https://github.com/airsdk/airsdk.dev/edit/main/docs/development/rich-media-content/working-with-video/using-the-stagevideo-apis.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Monitoring NetStream events","permalink":"/docs/development/rich-media-content/working-with-video/monitoring-netstream-events"},"next":{"title":"Working with cameras","permalink":"/docs/development/rich-media-content/working-with-cameras"}}');var o=n(74848),a=n(28453);const s={},d="Using the StageVideo APIs",r={},c=[{value:"Stage.stageVideos property",id:"stagestagevideos-property",level:2},{value:"StageVideo events",id:"stagevideo-events",level:2},{value:"Workflow for implementing the StageVideo feature",id:"workflow-for-implementing-the-stagevideo-feature",level:2},{value:"Initializing StageVideo event listeners",id:"initializing-stagevideo-event-listeners",level:2},{value:"Using the StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY event",id:"using-the-stagevideoavailabilityeventstage_video_availability-event",level:2},{value:"Using the StageVideoEvent.RENDER_STATE and VideoEvent.RENDER_STATE events",id:"using-the-stagevideoeventrender_state-and-videoeventrender_state-events",level:2},{value:"Color spaces",id:"color-spaces",level:2}];function l(e){const t={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"using-the-stagevideo-apis",children:"Using the StageVideo APIs"})}),"\n",(0,o.jsx)(t.p,{children:"Stage video is a mechanism within the runtime that enhances video playback and\ndevice performance. The runtime creates and maintains this mechanism; as a\ndeveloper, your role is to configure your application to take advantage of it."}),"\n",(0,o.jsxs)(t.p,{children:["To use stage video, you implement a framework of event handlers that detect when\nstage video is and isn't available. When you receive notification that stage\nvideo is available, you retrieve a StageVideo object from the\n",(0,o.jsx)(t.code,{children:"Stage.stageVideos"})," property. The runtime populates this Vector object with one\nor more StageVideo objects. You can then use one of the provided StageVideo\nobjects, rather than a Video object, to display streaming video."]}),"\n",(0,o.jsx)(t.p,{children:"On Flash Player, when you receive notification that stage video is no longer\navailable, switch your video stream back to a Video object."}),"\n",(0,o.jsx)(t.p,{children:"Note: You cannot create StageVideo objects."}),"\n",(0,o.jsx)(t.h2,{id:"stagestagevideos-property",children:"Stage.stageVideos property"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"Stage.stageVideos"})," property is a Vector object that gives you access to\nStageVideo instances. This vector can contain up to four StageVideo objects,\ndepending on hardware and system resources. Mobile devices can be limited to\none, or none."]}),"\n",(0,o.jsxs)(t.p,{children:["When stage video is not available, this vector contains no objects. To avoid run\ntime errors, be sure that you access members of this vector only when the most\nrecent ",(0,o.jsx)(t.code,{children:"StageVideoAvailability"})," event indicates that stage video is available."]}),"\n",(0,o.jsx)(t.h2,{id:"stagevideo-events",children:"StageVideo events"}),"\n",(0,o.jsx)(t.p,{children:"The StageVideo API framework provides the following events:"}),"\n",(0,o.jsxs)(t.p,{children:["StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY",(0,o.jsx)(t.br,{}),"\n","Sent when the ",(0,o.jsx)(t.code,{children:"Stage.stageVideos"})," property changes. The\n",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.availability"})," property indicates either ",(0,o.jsx)(t.code,{children:"AVAILABLE"}),"\nor ",(0,o.jsx)(t.code,{children:"UNAVAILABLE"}),". Use this event to determine whether the ",(0,o.jsx)(t.code,{children:"stageVideos"})," property\ncontains any StageVideo objects, rather than directly checking the length of the\n",(0,o.jsx)(t.code,{children:"Stage.stageVideos"})," vector."]}),"\n",(0,o.jsxs)(t.p,{children:["StageVideoEvent.RENDER_STATE",(0,o.jsx)(t.br,{}),"\n","Sent when a NetStream or Camera object has been attached to a StageVideo object\nand is playing. Indicates the type of decoding currently in use: hardware,\nsoftware, or unavailable (nothing is displayed). The event target contains\n",(0,o.jsx)(t.code,{children:"videoWidth"})," and ",(0,o.jsx)(t.code,{children:"videoHeight"})," properties that are safe to use for resizing the\nvideo viewport."]}),"\n",(0,o.jsx)(t.p,{children:"Important: Coordinates obtained from the StageVideo target object use Stage\ncoordinates, since they are not part of the standard display list."}),"\n",(0,o.jsxs)(t.p,{children:["VideoEvent.RENDER_STATE",(0,o.jsx)(t.br,{}),"\n","Sent when a Video object is being used. Indicates whether software or hardware\naccelerated decoding is in use. If this event indicates hardware accelerated\ndecoding, switch to a StageVideo object if possible. The Video event target\ncontains ",(0,o.jsx)(t.code,{children:"videoWidth"})," and ",(0,o.jsx)(t.code,{children:"videoHeight"})," properties that are safe to use for\nresizing the video viewport."]}),"\n",(0,o.jsx)(t.h2,{id:"workflow-for-implementing-the-stagevideo-feature",children:"Workflow for implementing the StageVideo feature"}),"\n",(0,o.jsx)(t.p,{children:"Follow these top-level steps to implement the StageVideo feature:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Listen for the ",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY"})," event"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"to find out when the `Stage.stageVideos` vector has changed. See\n[Using the StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY event](#using-the-stagevideoavailabilityeventstage_video_availability-event).\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsxs)(t.li,{children:["If the ",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY"})," event reports"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"that stage video is available, use the `Stage.stageVideos` Vector object\nwithin the event handler to access a StageVideo object.\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsxs)(t.li,{children:["Attach a NetStream object using ",(0,o.jsx)(t.code,{children:"StageVideo.attachNetStream()"})," or attach a"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"Camera object using `StageVideo.attachCamera()`.\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"4",children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Play the video using ",(0,o.jsx)(t.code,{children:"NetStream.play()"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Listen for the ",(0,o.jsx)(t.code,{children:"StageVideoEvent.RENDER_STATE"})," event on the StageVideo object"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"to determine the status of playing the video. Receipt of this event also\nindicates that the width and height properties of the video have been\ninitialized or changed. See\n[Using the StageVideoEvent.RENDER_STATE and VideoEvent.RENDER_STATE events](#using-the-stagevideoeventrender_state-and-videoeventrender_state-events).\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"6",children:["\n",(0,o.jsxs)(t.li,{children:["Listen for the ",(0,o.jsx)(t.code,{children:"VideoEvent.RENDER_STATE"})," event on the Video object. This"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"event provides the same statuses as `StageVideoEvent.RENDER_STATE,` so you\ncan also use it to determine whether GPU acceleration is available. Receipt\nof this event also indicates that the width and height properties of the\nvideo have been initialized or changed. See\n[Using the StageVideoEvent.RENDER_STATE and VideoEvent.RENDER_STATE events](#using-the-stagevideoeventrender_state-and-videoeventrender_state-events).\n"})}),"\n",(0,o.jsx)(t.h2,{id:"initializing-stagevideo-event-listeners",children:"Initializing StageVideo event listeners"}),"\n",(0,o.jsxs)(t.p,{children:["Set up your StageVideoAvailabilityEvent and VideoEvent listeners during\napplication initialization. For example, you can initialize these listeners in\nthe ",(0,o.jsx)(t.code,{children:"flash.events.Event.ADDED_TO_STAGE"})," event handler. This event guarantees\nthat your application is visible on the stage:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"public class SimpleStageVideo extends Sprite\nprivate var nc:NetConnection;\nprivate var ns:NetStream;\n\npublic function SimpleStageVideo()\n{\n"})}),"\n",(0,o.jsx)(t.p,{children:"// Constructor for SimpleStageVideo class\n// Make sure the app is visible and stage available\naddEventListener(Event.ADDED_TO_STAGE, onAddedToStage);"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"}\n\nprivate function onAddedToStage(event:Event):void\n{\n"})}),"\n",(0,o.jsx)(t.p,{children:"//...\n// Connections\nnc = new NetConnection();\nnc.connect(null);\nns = new NetStream(nc);\nns.addEventListener(NetStatusEvent.NET_STATUS, onNetStatus);\nns.client = this;"}),"\n",(0,o.jsx)(t.p,{children:"// Screen\nvideo = new Video();\nvideo.smoothing = true;"}),"\n",(0,o.jsx)(t.p,{children:"// Video Events\n// the StageVideoEvent.STAGE_VIDEO_STATE informs you whether\n// StageVideo is available\nstage.addEventListener(StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY,\nonStageVideoState);\n// in case of fallback to Video, listen to the VideoEvent.RENDER_STATE\n// event to handle resize properly and know about the acceleration mode running\nvideo.addEventListener(VideoEvent.RENDER_STATE, videoStateChange);\n//..."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"}\n"})}),"\n",(0,o.jsx)(t.h2,{id:"using-the-stagevideoavailabilityeventstage_video_availability-event",children:"Using the StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY event"}),"\n",(0,o.jsxs)(t.p,{children:["In the ",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY"})," handler, decide\nwhether to use a Video or StageVideo object based on the availability of\nStageVideo. If the ",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.availability"})," property is set to\n",(0,o.jsx)(t.code,{children:"StageVideoAvailability.AVAILABLE"}),", use StageVideo. In this case, you can rely\non the Stage.stageVideos vector to contain one or more StageVideo objects.\nObtain a StageVideo object from the ",(0,o.jsx)(t.code,{children:"Stage.stageVideos"})," property and attach the\nNetStream object to it. Because StageVideo objects always appear in the\nbackground, remove any existing Video object (always in the foreground). You\nalso use this event handler to add a listener for the\n",(0,o.jsx)(t.code,{children:"StageVideoEvent.RENDER_STATE"})," event."]}),"\n",(0,o.jsxs)(t.p,{children:["If the ",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.availability"})," property is set to\n",(0,o.jsx)(t.code,{children:"StageVideoAvailability.UNAVAILABLE"}),", do not use StageVideo or access the\n",(0,o.jsx)(t.code,{children:"Stage.stageVideos"})," vector. In this case, attach the NetStream object to a Video\nobject. Finally, add the StageVideo or Video object to the stage and call\n",(0,o.jsx)(t.code,{children:"NetStream.play()"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["The following code shows how to handle the\n",(0,o.jsx)(t.code,{children:"StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY"})," event:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"private var sv:StageVideo;\nprivate var video:Video;\n\nprivate function onStageVideoState(event:StageVideoAvailabilityEvent):void\n{\n\t// Detect if StageVideo is available and decide what to do in toggleStageVideo\n\ttoggleStageVideo(event.availability == StageVideoAvailability.AVAILABLE);\n}\n\nprivate function toggleStageVideo(on:Boolean):void\n{\n\t// To choose StageVideo attach the NetStream to StageVideo\n\tif (on)\n\t{\n\t\tstageVideoInUse = true;\n\t\tif ( sv == null )\n\t\t{\n\t\t\tsv = stage.stageVideos[0];\n\t\t\tsv.addEventListener(StageVideoEvent.RENDER_STATE, stageVideoStateChange);\n\t\t\t\tsv.attachNetStream(ns);\n\t\t}\n\n\t\tif (classicVideoInUse)\n\t\t{\n\t\t\t// If you use StageVideo, remove from the display list the\n\t\t\t// Video object to avoid covering the StageVideo object\n\t\t\t// (which is always in the background)\n\t\t\tstage.removeChild ( video );\n\t\t\tclassicVideoInUse = false;\n\t\t}\n\t}\n\telse\n\t{\n\t\t// Otherwise attach it to a Video object\n\t\tif (stageVideoInUse)\n\t\t\tstageVideoInUse = false;\n\t\tclassicVideoInUse = true;\n\t\tvideo.attachNetStream(ns);\n\t\tstage.addChildAt(video, 0);\n\t}\n\n\tif ( !played )\n\t{\n\t\tplayed = true;\n\t\tns.play(FILE_NAME);\n\t}\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Important: The first time an application accesses the vector element at\nStage.stageVideos[0], the default rect is set to 0,0,0,0, and pan and zoom\nproperties use default values. Always reset these values to your preferred\nsettings. You can use the ",(0,o.jsx)(t.code,{children:"videoWidth"})," and ",(0,o.jsx)(t.code,{children:"videoHeight"})," properties of the\n",(0,o.jsx)(t.code,{children:"StageVideoEvent.RENDER_STATE"})," or ",(0,o.jsx)(t.code,{children:"VideoEvent.RENDER_STATE"})," event target for\ncalculating the video viewport dimensions."]}),"\n",(0,o.jsxs)(t.p,{children:["Download the full source code for this sample application at\n",(0,o.jsx)(t.a,{href:"https://web.archive.org/web/20150228093631/http://www.adobe.com/devnet/flashplayer/articles/stage_video.html",children:"Getting Started with Stage Video"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"using-the-stagevideoeventrender_state-and-videoeventrender_state-events",children:"Using the StageVideoEvent.RENDER_STATE and VideoEvent.RENDER_STATE events"}),"\n",(0,o.jsxs)(t.p,{children:["StageVideo and Video objects send events that inform applications when the\ndisplay environment changes. These events are ",(0,o.jsx)(t.code,{children:"StageVideoEvent.RENDER_STATE"})," and\n",(0,o.jsx)(t.code,{children:"VideoEvent.RENDER_STATE"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["A StageVideo or Video object dispatches a render state event when a NetStream\nobject is attached and begins playing. It also sends this event when the display\nenvironment changes; for example, when the video viewport is resized. Use these\nnotifications to reset your viewport to the current ",(0,o.jsx)(t.code,{children:"videoHeight"})," and\n",(0,o.jsx)(t.code,{children:"videoWidth"})," values of the event target object."]}),"\n",(0,o.jsx)(t.p,{children:"Reported render states include:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"RENDER_STATUS_UNAVAILABLE"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"RENDER_STATUS_SOFTWARE"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"RENDER_STATUS_ACCELERATED"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Render states indicate when hardware accelerated decoding is in use, regardless\nof which class is currently playing video. Check the ",(0,o.jsx)(t.code,{children:"StageVideoEvent.status"}),'\nproperty to learn whether the necessary decoding is available. If this property\nis set to "unavailable", the StageVideo object cannot play the video. This\nstatus requires that you immediately reattach the NetStream object to a Video\nobject. Other statuses inform your application of the current rendering\nconditions.']}),"\n",(0,o.jsx)(t.p,{children:"The following table describes the implications of all render status values for\nStageVideoEvent and VideoEvent objects in Flash Player:"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{}),(0,o.jsx)(t.th,{children:"VideoStatus.ACCELERATED"}),(0,o.jsx)(t.th,{children:"VideoStatus.SOFTWARE"}),(0,o.jsx)(t.th,{children:"VideoStatus.UNAVAILABLE"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"StageVideoEvent"}),(0,o.jsx)(t.td,{children:"Decoding and presentation both occur in hardware. (Best performance.)"}),(0,o.jsx)(t.td,{children:"Presentation in hardware, decoding in software. (Acceptable performance.)"}),(0,o.jsxs)(t.td,{children:["No GPU resources are available to handle video, and nothing is displayed. ",(0,o.jsx)(t.strong,{children:"Fall back to a Video object."})]})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"VideoEvent"}),(0,o.jsx)(t.td,{children:"Presentation in software, decoding in hardware. (Acceptable performance on a modern desktop system only. Degraded full-screen performance.)"}),(0,o.jsx)(t.td,{children:"Presentation in software, decoding in software. (Worst case performance-wise. Degraded full-screen performance.)"}),(0,o.jsx)(t.td,{children:"(N/A)"})]})]})]}),"\n",(0,o.jsx)(t.h2,{id:"color-spaces",children:"Color spaces"}),"\n",(0,o.jsx)(t.p,{children:"Stage video uses underlying hardware capabilities to support color spaces. SWF\ncontent can provide metadata indicating its preferred color space. However, the\ndevice graphics hardware determines whether that color space can be used. One\ndevice can support several color spaces, while another supports none. If the\nhardware does not support the requested color space, Flash Player attempts to\nfind the closest match among the supported color spaces."}),"\n",(0,o.jsxs)(t.p,{children:["To query which color spaces the hardware supports, use the\n",(0,o.jsx)(t.code,{children:"StageVideo.colorSpaces"})," property. This property returns the list of supported\ncolor spaces in a String vector:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"var colorSpace:Vector.<String> = stageVideo.colorSpaces();\n"})}),"\n",(0,o.jsxs)(t.p,{children:["To learn which color space the currently playing video is using, check the\n",(0,o.jsx)(t.code,{children:"StageVideoEvent.colorSpace"})," property. Check this property in your event handler\nfor the ",(0,o.jsx)(t.code,{children:"StageVideoEvent.RENDER_STATE"})," event:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"var currColorSpace:String;\n\n//StageVideoEvent.RENDER_STATE event handler\nprivate function stageVideoRenderState(event:Object):void\n{\n\t//...\n\tcurrColorSpace = (event as StageVideoEvent).colorSpace;\n\t//...\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["If Flash Player cannot find a substitute for an unsupported color space, stage\nvideo uses the default color space BT.601. For example, video streams with H.264\nencoding typically use the BT.709 color space. If the device hardware does not\nsupport BT.709, the ",(0,o.jsx)(t.code,{children:"colorSpace"})," property returns ",(0,o.jsx)(t.code,{children:'"BT601"'}),". A\n",(0,o.jsx)(t.code,{children:"StageVideoEvent.colorSpace"})," value of ",(0,o.jsx)(t.code,{children:'"unknown"'})," indicates that the hardware\ndoes not provide a means of querying the color space."]}),"\n",(0,o.jsx)(t.p,{children:"If your application deems the current color space unacceptable, you can choose\nto switch from a StageVideo object to a Video object. The Video class supports\nall color spaces through software compositing."})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);