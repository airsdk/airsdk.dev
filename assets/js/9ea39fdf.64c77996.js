"use strict";(self.webpackChunkairsdk_dev=self.webpackChunkairsdk_dev||[]).push([[1022],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var i=t(96540);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}},75201:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"development/html-content-in-air/handling-html-related-events-in-air","title":"Handling HTML-related events in AIR","description":"An event-handling system allows programmers to respond to user input and system","source":"@site/docs/development/html-content-in-air/handling-html-related-events-in-air.md","sourceDirName":"development/html-content-in-air","slug":"/development/html-content-in-air/handling-html-related-events-in-air","permalink":"/docs/development/html-content-in-air/handling-html-related-events-in-air","draft":false,"unlisted":false,"editUrl":"https://github.com/airsdk/airsdk.dev/edit/main/docs/development/html-content-in-air/handling-html-related-events-in-air.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"mainSidebar","previous":{"title":"Setting the user agent used when loading HTML content","permalink":"/docs/development/html-content-in-air/scripting-the-air-html-container/setting-the-user-agent-when-loading-html-content"},"next":{"title":"Displaying HTML content in mobile apps","permalink":"/docs/development/html-content-in-air/displaying-html-content-in-mobile-apps"}}');var r=t(74848),a=t(28453);const o={sidebar_position:4},s="Handling HTML-related events in AIR",c={},d=[{value:"HTMLLoader events",id:"htmlloader-events",level:2},{value:"Handling DOM events with ActionScript",id:"handling-dom-events-with-actionscript",level:2},{value:"Responding to uncaught JavaScript exceptions",id:"responding-to-uncaught-javascript-exceptions",level:2},{value:"Handling runtime events with JavaScript",id:"handling-runtime-events-with-javascript",level:2},{value:"Creating an event handler function",id:"creating-an-event-handler-function",level:3},{value:"Removing event listeners",id:"removing-event-listeners",level:4},{value:"Removing event listeners in HTML pages that navigate",id:"removing-event-listeners-in-html-pages-that-navigate",level:4},{value:"Checking for existing event listeners",id:"checking-for-existing-event-listeners",level:4}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"handling-html-related-events-in-air",children:"Handling HTML-related events in AIR"})}),"\n",(0,r.jsx)(n.p,{children:"An event-handling system allows programmers to respond to user input and system\nevents in a convenient way. The Adobe\xae AIR\xae event model is not only convenient,\nbut also standards-compliant. Based on the Document Object Model (DOM) Level 3\nEvents Specification, an industry-standard event-handling architecture, the\nevent model provides a powerful, yet intuitive, event-handling tool for\nprogrammers."}),"\n",(0,r.jsx)(n.h2,{id:"htmlloader-events",children:"HTMLLoader events"}),"\n",(0,r.jsx)(n.p,{children:"An HTMLLoader object dispatches the following Adobe\xae ActionScript\xae 3.0 events:"}),"\n",(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:(0,r.jsx)("p",{children:"Event"})}),(0,r.jsx)("th",{children:(0,r.jsx)("p",{children:"Description"})})]})}),(0,r.jsxs)("tbody",{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"htmlDOMInitialize"})})}),(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)(n.p,{children:"Dispatched when the HTML document is created, but before any scripts\nare parsed or DOM nodes are added to the page."})})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"complete"})})}),(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["Dispatched when the HTML DOM has been created in response to a load\noperation, immediately after the ",(0,r.jsx)("samp",{children:"onload"})," event in the HTML\npage."]})})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"htmlBoundsChanged"})})}),(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["Dispatched when one or both of the ",(0,r.jsx)("samp",{children:"contentWidth"})," and\n",(0,r.jsx)("samp",{children:"contentHeight"})," properties have changed."]})})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"locationChange"})})}),(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)(n.p,{children:"Dispatched when the location property of the HTMLLoader has changed."})})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"locationChanging"})})}),(0,r.jsxs)("td",{children:[(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["Dispatched before the location of the HTMLLoader changes because of\nuser navigation, a JavaScript call, or a redirect. The\n",(0,r.jsx)("samp",{children:"locationChanging"})," event is not dispatched when you call\nthe ",(0,r.jsx)("samp",{children:"load()"}),", ",(0,r.jsx)("samp",{children:"loadString()"}),",\n",(0,r.jsx)("samp",{children:"reload()"}),", ",(0,r.jsx)("samp",{children:"historyGo()"}),",\n",(0,r.jsx)("samp",{children:"historyForward()"}),", or ",(0,r.jsx)("samp",{children:"historyBack()"})," methods."]})}),(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["Calling the ",(0,r.jsx)("samp",{children:"preventDefault()"})," method of the dispatched\nevent object cancels navigation."]})}),(0,r.jsx)("p",{children:(0,r.jsx)(n.p,{children:"If a link is opened in the system browser, a locationChanging event is\nnot dispatched since the HTMLLoader does not change location."})})]})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"scroll"})})}),(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["Dispatched anytime the HTML engine changes the scroll position. Scroll\nevents can be because of navigation to anchor links (\n",(0,r.jsx)("samp",{children:"#"})," links) in the page or because of calls to the\n",(0,r.jsx)("samp",{children:"window.scrollTo()"})," method. Entering text in a text input\nor text area can also cause a scroll event."]})})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)("samp",{children:"uncaughtScriptException"})})}),(0,r.jsx)("td",{children:(0,r.jsx)("p",{children:(0,r.jsx)(n.p,{children:"Dispatched when a JavaScript exception occurs in the HTMLLoader and\nthe exception is not caught in JavaScript code."})})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["You can also register an ActionScript function for a JavaScript event (such as\n",(0,r.jsx)(n.code,{children:"onClick"}),"). For details, see\n",(0,r.jsx)(n.a,{href:"/docs/development/html-content-in-air/handling-html-related-events-in-air#handling-dom-events-with-actionscript",children:"Handling DOM events with ActionScript"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"handling-dom-events-with-actionscript",children:"Handling DOM events with ActionScript"}),"\n",(0,r.jsx)(n.p,{children:"You can register ActionScript functions to respond to JavaScript events. For\nexample, consider the following HTML content:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'<html>\n<body>\n\t<a href="#" id="testLink">Click me.</a>\n</html>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You can register an ActionScript function as a handler for any event in the\npage. For example, the following code adds the ",(0,r.jsx)(n.code,{children:"clickHandler()"})," function as the\nlistener for the ",(0,r.jsx)(n.code,{children:"onclick"})," event of the ",(0,r.jsx)(n.code,{children:"testLink"})," element in the HTML page:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'var html:HTMLLoader = new HTMLLoader( );\nvar urlReq:URLRequest = new URLRequest("test.html");\nhtml.load(urlReq);\nhtml.addEventListener(Event.COMPLETE, completeHandler);\n\nfunction completeHandler(event:Event):void {\n\thtml.window.document.getElementById("testLink").onclick = clickHandler;\n}\n\nfunction clickHandler( event:Object ):void {\n\ttrace("Event of type: " + event.type );\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The event object dispatched is not of type flash.events.Event or one of the\nEvent subclasses. Use the Object class to declare a type for the event handler\nfunction argument."}),"\n",(0,r.jsxs)(n.p,{children:["You can also use the ",(0,r.jsx)(n.code,{children:"addEventListener()"})," method to register for these events.\nFor example, you could replace the ",(0,r.jsx)(n.code,{children:"completeHandler()"})," method in the previous\nexample with the following code:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'function completeHandler(event:Event):void {\n\tvar testLink:Object = html.window.document.getElementById("testLink");\n\ttestLink.addEventListener("click", clickHandler);\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When a listener refers to a specific DOM element, it is good practice to wait\nfor the parent HTMLLoader to dispatch the ",(0,r.jsx)(n.code,{children:"complete"})," event before adding the\nevent listeners. HTML pages often load multiple files and the HTML DOM is not\nfully built until all the files are loaded and parsed. The HTMLLoader dispatches\nthe ",(0,r.jsx)(n.code,{children:"complete"})," event when all elements have been created."]}),"\n",(0,r.jsx)(n.h2,{id:"responding-to-uncaught-javascript-exceptions",children:"Responding to uncaught JavaScript exceptions"}),"\n",(0,r.jsx)(n.p,{children:"Consider the following HTML:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'<html>\n<head>\n\t<script>\n\t\tfunction throwError() {\n\t\t\tvar x = 400 * melbaToast;\n\t\t}\n\t<\/script>\n</head>\n<body>\n\t<a href="#" onclick="throwError()">Click me.</a>\n</html>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["It contains a JavaScript function, ",(0,r.jsx)(n.code,{children:"throwError()"}),", that references an unknown\nvariable, ",(0,r.jsx)(n.code,{children:"melbaToast"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"var x = 400 * melbaToast;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["When a JavaScript operation encounters an illegal operation that is not caught\nin the JavaScript code with a ",(0,r.jsx)(n.code,{children:"try"})," / ",(0,r.jsx)(n.code,{children:"catch"})," structure, the HTMLLoader object\ncontaining the page dispatches an HTMLUncaughtScriptExceptionEvent event. You\ncan register a handler for this event, as in the following code:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'var html:HTMLLoader = new HTMLLoader();\nvar urlReq:URLRequest = new URLRequest("test.html");\nhtml.load(urlReq);\nhtml.width = container.width;\nhtml.height = container.height;\ncontainer.addChild(html);\nhtml.addEventListener(HTMLUncaughtScriptExceptionEvent.UNCAUGHT_SCRIPT_EXCEPTION,\n                        htmlErrorHandler);\nfunction htmlErrorHandler(event:HTMLUncaughtJavaScriptExceptionEvent):void\n{\n\tevent.preventDefault();\n\ttrace("exceptionValue:", event.exceptionValue)\n\tfor (var i:int = 0; i < event.stackTrace.length; i++)\n\t{\n\t\ttrace("sourceURL:", event.stackTrace[i].sourceURL);\n\t\ttrace("line:", event.stackTrace[i].line);\n\t\ttrace("function:", event.stackTrace[i].functionName);\n\t}\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Within JavaScript, you can handle the same event using the window.htmlLoader\nproperty:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'<html>\n<head>\n\t<script language="javascript" type="text/javascript" src="AIRAliases.js"><\/script>\n\t<script>\n\t\tfunction throwError() {\n\t\t\tvar x = 400 * melbaToast;\n\t\t}\n\n\t\tfunction htmlErrorHandler(event) {\n\t\t\tevent.preventDefault();\n\t\t\tvar message = "exceptionValue:" + event.exceptionValue + "\\n";\n\t\t\tfor (var i = 0; i < event.stackTrace.length; i++){\n\t\t\t\tmessage += "sourceURL:" + event.stackTrace[i].sourceURL +"\\n";\n\t\t\t\tmessage += "line:" + event.stackTrace[i].line +"\\n";\n\t\t\t\tmessage += "function:" + event.stackTrace[i].functionName + "\\n";\n\t\t\t}\n\t\t\talert(message);\n\t\t}\n\n\t\twindow.htmlLoader.addEventListener("uncaughtScriptException", htmlErrorHandler);\n\t<\/script>\n</head>\n<body>\n\t<a href="#" onclick="throwError()">Click me.</a>\n</html>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"htmlErrorHandler()"})," event handler cancels the default behavior of the event\n(which is to send the JavaScript error message to the AIR trace output), and\ngenerates its own output message. It outputs the value of the ",(0,r.jsx)(n.code,{children:"exceptionValue"}),"\nof the HTMLUncaughtScriptExceptionEvent object. It outputs the properties of\neach object in the ",(0,r.jsx)(n.code,{children:"stackTrace"})," array:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"exceptionValue: ReferenceError: Can't find variable: melbaToast\nsourceURL: app:/test.html\nline: 5\nfunction: throwError\nsourceURL: app:/test.html\nline: 10\nfunction: onclick\n"})}),"\n",(0,r.jsx)(n.h2,{id:"handling-runtime-events-with-javascript",children:"Handling runtime events with JavaScript"}),"\n",(0,r.jsxs)(n.p,{children:["The runtime classes support adding event handlers with the ",(0,r.jsx)(n.code,{children:"addEventListener()"}),"\nmethod. To add a handler function for an event, call the ",(0,r.jsx)(n.code,{children:"addEventListener()"}),"\nmethod of the object that dispatches the event, providing the event type and the\nhandling function. For example, to listen for the ",(0,r.jsx)(n.code,{children:"closing"})," event dispatched\nwhen a user clicks the window close button on the title bar, use the following\nstatement:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"window.nativeWindow.addEventListener(air.NativeWindow.CLOSING, handleWindowClosing);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-an-event-handler-function",children:"Creating an event handler function"}),"\n",(0,r.jsxs)(n.p,{children:["The following code creates a simple HTML file that displays information about\nthe position of the main window. A handler function named ",(0,r.jsx)(n.code,{children:"moveHandler()"}),",\nlistens for a move event (defined by the NativeWindowBoundsEvent class) of the\nmain window."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'<html>\n<script src="AIRAliases.js" />\n<script>\n    function init() {\n        writeValues();\n        window.nativeWindow.addEventListener(air.NativeWindowBoundsEvent.MOVE,\n                                                    moveHandler);\n    }\n    function writeValues() {\n        document.getElementById("xText").value = window.nativeWindow.x;\n        document.getElementById("yText").value = window.nativeWindow.y;\n    }\n    function moveHandler(event) {\n        air.trace(event.type); // move\n        writeValues();\n    }\n<\/script>\n<body onload="init()" />\n    <table>\n        <tr>\n            <td>Window X:</td>\n            <td><textarea id="xText"></textarea></td>\n        </tr>\n        <tr>\n            <td>Window Y:</td>\n            <td><textarea id="yText"></textarea></td>\n        </tr>\n    </table>\n</body>\n</html>\n'})}),"\n",(0,r.jsx)(n.p,{children:"When a user moves the window, the textarea elements display the updated X and Y\npositions of the window:"}),"\n",(0,r.jsxs)(n.p,{children:["Notice that the event object is passed as an argument to the ",(0,r.jsx)(n.code,{children:"moveHandler()"}),"\nmethod. The event parameter allows your handler function to examine the event\nobject. In this example, you use the event object's ",(0,r.jsx)(n.code,{children:"type"})," property to report\nthat the event is a ",(0,r.jsx)(n.code,{children:"move"})," event."]}),"\n",(0,r.jsx)(n.h4,{id:"removing-event-listeners",children:"Removing event listeners"}),"\n",(0,r.jsxs)(n.p,{children:["You can use the ",(0,r.jsx)(n.code,{children:"removeEventListener()"})," method to remove an event listener that\nyou no longer need. It is a good idea to remove any listeners that will no\nlonger be used. Required parameters include the ",(0,r.jsx)(n.code,{children:"eventName"})," and ",(0,r.jsx)(n.code,{children:"listener"}),"\nparameters, which are the same as the required parameters for the\n",(0,r.jsx)(n.code,{children:"addEventListener()"})," method."]}),"\n",(0,r.jsx)(n.h4,{id:"removing-event-listeners-in-html-pages-that-navigate",children:"Removing event listeners in HTML pages that navigate"}),"\n",(0,r.jsx)(n.p,{children:'When HTML content navigates, or when HTML content is discarded because a window\nthat contains it is closed, the event listeners that reference objects on the\nunloaded page are not automatically removed. When an object dispatches an event\nto a handler that has already been unloaded, you see the following error\nmessage: "The application attempted to reference a JavaScript object in an HTML\npage that is no longer loaded."'}),"\n",(0,r.jsxs)(n.p,{children:["To avoid this error, remove JavaScript event listeners in an HTML page before it\ngoes away. In the case of page navigation (within an HTMLLoader object), remove\nthe event listener during the ",(0,r.jsx)(n.code,{children:"unload"})," event of the ",(0,r.jsx)(n.code,{children:"window"})," object."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, the following JavaScript code removes an event listener for an\n",(0,r.jsx)(n.code,{children:"uncaughtScriptException"})," event:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"window.onunload = cleanup;\nwindow.htmlLoader.addEventListener('uncaughtScriptException', uncaughtScriptException);\nfunction cleanup()\n{\n\twindow.htmlLoader.removeEventListener('uncaughtScriptException',\n\t\t\t\t\t\t\tuncaughtScriptExceptionHandler);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To prevent the error from occurring when closing windows that contain HTML\ncontent, call a cleanup function in response to the ",(0,r.jsx)(n.code,{children:"closing"})," event of the\nNativeWindow object ( ",(0,r.jsx)(n.code,{children:"window.nativeWindow"}),"). For example, the following\nJavaScript code removes an event listener for an ",(0,r.jsx)(n.code,{children:"uncaughtScriptException"}),"\nevent:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"window.nativeWindow.addEventListener(air.Event.CLOSING, cleanup);\nfunction cleanup()\n{\n\twindow.htmlLoader.removeEventListener('uncaughtScriptException',\n\t\t\t\t\t\t\tuncaughtScriptExceptionHandler);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also prevent this error from occurring by removing an event listener as\nsoon as it runs (if the event only needs to be handled once). For example, the\nfollowing JavaScript code creates an html window by calling the\n",(0,r.jsx)(n.code,{children:"createRootWindow()"})," method of the HTMLLoader class and adds an event listener\nfor the ",(0,r.jsx)(n.code,{children:"complete"})," event. When the ",(0,r.jsx)(n.code,{children:"complete"})," event handler is called, it\nremoves its own event listener using the ",(0,r.jsx)(n.code,{children:"removeEventListener()"})," function:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"var html = runtime.flash.html.HTMLLoader.createRootWindow(true);\nhtml.addEventListener('complete', htmlCompleteListener);\nfunction htmlCompleteListener()\n{\n\thtml.removeEventListener(complete, arguments.callee);\n\t// handler code..\n}\nhtml.load(new runtime.flash.net.URLRequest(\"second.html\"));\n"})}),"\n",(0,r.jsx)(n.p,{children:"Removing unneeded event listeners also allows the system garbage collector to\nreclaim any memory associated with those listeners."}),"\n",(0,r.jsx)(n.h4,{id:"checking-for-existing-event-listeners",children:"Checking for existing event listeners"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"hasEventListener()"})," method lets you check for the existence of an event\nlistener on an object."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);