"use strict";(self.webpackChunkairsdk_dev=self.webpackChunkairsdk_dev||[]).push([[39119],{28453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>l});var n=i(96540);const o={},a=n.createContext(o);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(a.Provider,{value:t},e.children)}},98811:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"tutorials/platform/macos/creating-macos-pkg-files","title":"Creating macOS PKG installers","description":"This tutorial guides you through creating, signing and notarizing a PKG file that can be used to distribute and install your application for macOS, outside of the App Store.","source":"@site/docs/tutorials/platform/macos/creating-macos-pkg-files.md","sourceDirName":"tutorials/platform/macos","slug":"/tutorials/platform/macos/creating-macos-pkg-files","permalink":"/docs/tutorials/platform/macos/creating-macos-pkg-files","draft":false,"unlisted":false,"editUrl":"https://github.com/airsdk/airsdk.dev/edit/main/docs/tutorials/platform/macos/creating-macos-pkg-files.md","tags":[],"version":"current","frontMatter":{"title":"Creating macOS PKG installers"},"sidebar":"mainSidebar","previous":{"title":"Packaging a desktop native installer","permalink":"/docs/tutorials/platform/desktop/packaging-native-installer"},"next":{"title":"ActionScript 3.0 Developer\'s Guide: Table of Contents","permalink":"/docs/development/"}}');var o=i(74848),a=i(28453);const r={title:"Creating macOS PKG installers"},l=void 0,s={},c=[{value:"Prepare your Mac for code signing",id:"prepare-your-mac-for-code-signing",level:3},{value:"Create and install your &#39;Developer ID Application&#39; certificate",id:"create-and-install-your-developer-id-application-certificate",level:4},{value:"Prepare the other certificates in the chain",id:"prepare-the-other-certificates-in-the-chain",level:4},{value:"Test if you now have a complete certificate signing chain",id:"test-if-you-now-have-a-complete-certificate-signing-chain",level:4},{value:"Figure out your app bundle command",id:"figure-out-your-app-bundle-command",level:3},{value:"Start with your iOS command.",id:"start-with-your-ios-command",level:4},{value:"Update the command to build a bundle",id:"update-the-command-to-build-a-bundle",level:4},{value:"Create an entitlements file",id:"create-an-entitlements-file",level:4},{value:"Sign your bundle",id:"sign-your-bundle",level:4},{value:"Sign your ANEs",id:"sign-your-anes",level:4},{value:"Sign the main binary file",id:"sign-the-main-binary-file",level:4},{value:"Create your .pkg file",id:"create-your-pkg-file",level:3},{value:"Get a Developer ID Installer certificate.",id:"get-a-developer-id-installer-certificate",level:4},{value:"Pkg command",id:"pkg-command",level:4},{value:"Notarize your .pkg file",id:"notarize-your-pkg-file",level:3},{value:"Staple your notarization to your pkg file",id:"staple-your-notarization-to-your-pkg-file",level:4},{value:"Useful links",id:"useful-links",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsxs)(t.p,{children:["This tutorial guides you through creating, signing and notarizing a PKG file that can be used to distribute and install your application for macOS, outside of the App Store.\nPut together by ",(0,o.jsx)(t.a,{href:"https://github.com/Ender22",children:"Ender22"})," (see the ",(0,o.jsx)(t.a,{href:"https://github.com/airsdk/Adobe-Runtime-Support/discussions/2088#discussioncomment-3622583",children:"original thread on github"}),")"]})}),"\n",(0,o.jsxs)(t.admonition,{type:"note",children:[(0,o.jsx)(t.p,{children:"Important: For distributing application on macOS, you now have just two options:"}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Deployment on the App Store - for which you need an App Store certificate"}),"\n",(0,o.jsx)(t.li,{children:"Manual deployment outside of this - for which you need a Developer ID certificate"}),"\n"]}),(0,o.jsx)(t.p,{children:"You'll need an Apple developer account in order to obtain these certificates and to complete this process."}),(0,o.jsx)(t.p,{children:"It also assumes you already have a working publishing process for iOS and that you use IntelliJ on your Mac PC (although the steps can likely help anyone looking to take their air app to the Mac audience)"})]}),"\n",(0,o.jsx)(t.h3,{id:"prepare-your-mac-for-code-signing",children:"Prepare your Mac for code signing"}),"\n",(0,o.jsx)(t.h4,{id:"create-and-install-your-developer-id-application-certificate",children:"Create and install your 'Developer ID Application' certificate"}),"\n",(0,o.jsxs)(t.p,{children:["Start by logging into your developer.apple.com account. Proceed to the certificate section and create a new 'Developer ID Application' certificate. Choose the G2 Sub-CA (Xcode 11.4.1 or later) option. If you don't have a 'Certificate Signing Request' follow ",(0,o.jsx)(t.a,{href:"https://help.apple.com/developer-account/#/devbfa00fef7",children:"this apple guide"})," to create one."]}),"\n",(0,o.jsx)(t.p,{children:"Save your new 'Developer ID Application' certificate to your machine."}),"\n",(0,o.jsx)(t.p,{children:"I found it best to install all my certificates on both my 'System' and 'login' parts of the keychain. To do this open keychain and click the System tab, then double-click your certificate to install it. You'll see the new certificate appear in the list. Next, do the same thing but from the login tab."}),"\n",(0,o.jsx)(t.h4,{id:"prepare-the-other-certificates-in-the-chain",children:"Prepare the other certificates in the chain"}),"\n",(0,o.jsxs)(t.p,{children:["In Keychain, right-click on your new 'Developer ID Application' certificate and press 'Get Info'. Look at the Common Name in the Issuer Name section for me it's \"Developer ID Certificate Authority\" with the \"G2\" organizational unit. Proceed to ",(0,o.jsx)(t.a,{href:"https://www.apple.com/certificateauthority/",children:"https://www.apple.com/certificateauthority/"}),' and under "Apple Intermediate Certificates" find the matching certificate i.e. "Developer ID - G2 (Expiring 09/17/2031 00:00:00 UTC)". Download and install this certificate again to the System and Login parts of your keychain.']}),"\n",(0,o.jsx)(t.p,{children:'Repeat the process again this time clicking on your new "Developer ID Certificate Authority" certificate. For this one, my Issuer name is "Apple Root CA" So I went back to the certificate authority and then downloaded and installed that certificate: "Apple Root CA - G2 Root"'}),"\n",(0,o.jsx)(t.p,{children:'That is likely enough, but I also downloaded and installed the "Apple Inc. Root" certificate just in case.'}),"\n",(0,o.jsx)(t.h4,{id:"test-if-you-now-have-a-complete-certificate-signing-chain",children:"Test if you now have a complete certificate signing chain"}),"\n",(0,o.jsx)(t.p,{children:'Click on each of your new certificates in Keychain and ensure they all say "This certificate is valid". Next, we will try to sign a file to see if it works.'}),"\n",(0,o.jsx)(t.p,{children:"First, copy your adl application into a folder so we have something to sign with the following:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"cp /path/to/AIR/SDK/bin/adl .\n"})}),"\n",(0,o.jsx)(t.p,{children:"Next, try signing it. I recommend using your full certificate name, in my case, I'll pretend my company's name is ECorp:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'codesign -f -s "Developer ID Application: ECorp (XXXXXXXX)" adl\n'})}),"\n",(0,o.jsxs)(t.p,{children:["You should see a message: ",(0,o.jsx)(t.code,{children:"replacing existing signature"}),"\nYou can see the result with the following:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"codesign -dvvv adl\n"})}),"\n",(0,o.jsx)(t.p,{children:"If the signing doesn't work then there is something wrong with the chain of certificates installed and you should ensure you installed all of the correct ones. Reinstalling them can help and make sure you don't edit them and press 'Always Allow' as apparently, that causes issues."}),"\n",(0,o.jsx)(t.h3,{id:"figure-out-your-app-bundle-command",children:"Figure out your app bundle command"}),"\n",(0,o.jsx)(t.h4,{id:"start-with-your-ios-command",children:"Start with your iOS command."}),"\n",(0,o.jsxs)(t.p,{children:["We will need to create our bundle using the command line rather than IntelliJ.\nIf you are like me and find the subtleties of the command line difficult it can help to start from your existing working command line that you use for iOS packaging.\nYou can find the command line IntelliJ uses by setting up the ",(0,o.jsx)(t.code,{children:"DebugOut"})," configuration value in the AIR SDK ",(0,o.jsx)(t.code,{children:"adt.cfg"})," file.\nThen build your app like normal and look in the newly created ",(0,o.jsx)(t.code,{children:"~/adt.log"})," file to see what command line had been passed to ADT."]}),"\n",(0,o.jsx)(t.h4,{id:"update-the-command-to-build-a-bundle",children:"Update the command to build a bundle"}),"\n",(0,o.jsxs)(t.p,{children:["Next, update the command so that it creates a macOS application bundle (",(0,o.jsx)(t.code,{children:".app"})," folder). My final command looked like:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'/path/to/adt -package -storetype KeychainStore -alias "Developer ID Application: ECorp(XXXXXXXXX)" -target bundle /path/to/bundle/you/want/to/create /path/to/your/application.xml -extdir /path/to/anes/if/you/use/them -C /path/to/your/swf ECorp.swf -C /path/to/your/assets . -C /path/to/your/icons . -C /path/to/your/launch/images\n'})}),"\n",(0,o.jsx)(t.p,{children:"Run the command and if all goes well you'll have a new bundle.app file. This file won't work yet as it is only partially signed."}),"\n",(0,o.jsx)(t.h4,{id:"create-an-entitlements-file",children:"Create an entitlements file"}),"\n",(0,o.jsxs)(t.p,{children:["In order to fully sign this, we'll need to sign it with an entitlements file. Create a file called ",(0,o.jsx)(t.code,{children:"app.entitlements"})," in the same directory as your swf with the following contents:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n<plist version="1.0">\n<dict>\n        <key>com.apple.security.cs.allow-dyld-environment-variables</key>\n        <true/>\n        <key>com.apple.security.cs.allow-jit</key>\n        <true/>\n        <key>com.apple.security.cs.allow-unsigned-executable-memory</key>\n        <true/>\n        <key>com.apple.security.cs.disable-library-validation</key>\n        <true/>\n</dict>\n</plist>\n'})}),"\n",(0,o.jsx)(t.h4,{id:"sign-your-bundle",children:"Sign your bundle"}),"\n",(0,o.jsx)(t.p,{children:'Now sign your bundle again with the entitlements and these specific options.\ncodesign --entitlements /path/to/app.entitlements -s "Developer ID Application: ECorp (XXXXXXX)" -f -o runtime --strict --timestamp -v /path/to/your/bundle.app'}),"\n",(0,o.jsx)(t.h4,{id:"sign-your-anes",children:"Sign your ANEs"}),"\n",(0,o.jsx)(t.p,{children:"Any ANEs will need to be signed. For now, you could skip this step until Apple rejects your notarization process and then come back to it once you know which ANEs aren't yet signed. Once you know which ones, you'll sign their framework folder as follows:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'codesign -f --options runtime -s "Developer ID Application: ECorp (XXXXXXXXX)" "/path/to/bundle.app/Contents/Resources/META-INF/AIR/extensions/extension-name/META-INF/ANE/MacOS-x86-64/ExtName.framework"\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Repeat for each ANE that needs to be signed. Note you may also need to sign other components (",(0,o.jsx)(t.code,{children:".dylib"})," files if present) - notarization reports will give this information."]}),"\n",(0,o.jsx)(t.h4,{id:"sign-the-main-binary-file",children:"Sign the main binary file"}),"\n",(0,o.jsx)(t.p,{children:"After signing the ANEs you'll need to sign the main application bundle files (which gives a final signature to the executable located in the Contents/MacOS folder of your bundle). Here's my command for this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'codesign --entitlements /path/to/app.entitlements -f --options runtime --strict --timestamp -v -s "Developer ID Application: ECorp (XXXXXXXXX)" "/path/to/bundle.app"\n'})}),"\n",(0,o.jsxs)(t.admonition,{type:"note",children:[(0,o.jsxs)(t.p,{children:['It should be possible to request the ADL tool to do "native signing" of the bundle, which eliminates the need for the entitlements and these manual signing steps.\nTo do this you need to repeat the signing options after the ',(0,o.jsx)(t.code,{children:"-target bundle"})," command.\nNote that the certificate alias you're using must be present and valid in your Keychain tool with the exact same name, and you will likely get a request to authorise ADL to access your keychain for this process."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'/path/to/adt -package -storetype KeychainStore -alias "Developer ID Application: ECorp(XXXXXXXXX)" -target bundle -storetype KeychainStore -alias "Developer ID Application: ECorp(XXXXXXXXX)" /path/to/bundle/you/want/to/create /path/to/your/application.xml -extdir /path/to/anes/if/you/use/them -C /path/to/your/swf ECorp.swf -C /path/to/your/assets . -C /path/to/your/icons . -C /path/to/your/launch/images\n'})}),(0,o.jsxs)(t.p,{children:["This option will also incorporate any entitlements that are listed in the application descriptor file under the ",(0,o.jsx)(t.code,{children:"<macOS><Entitlements>"})," block."]})]}),"\n",(0,o.jsx)(t.p,{children:"The output of this stage should be a suitably signed application bundle folder. It is worth checking that this will run properly at this stage: if something has gone wrong with signing and/or entitlements, this is the time to put this right."}),"\n",(0,o.jsx)(t.h3,{id:"create-your-pkg-file",children:"Create your .pkg file"}),"\n",(0,o.jsx)(t.p,{children:"Assuming you want to distribute via a .pkg file you can create one as follows. Apparently, you can also create .dmg files that can contain your application, or just zip your bundle, but this results in a file that your users\ncan launch and results in a wizard-style installer."}),"\n",(0,o.jsx)(t.h4,{id:"get-a-developer-id-installer-certificate",children:"Get a Developer ID Installer certificate."}),"\n",(0,o.jsx)(t.p,{children:"Head back to developer.apple.com and create a new certificate. This time it will be of the 'Developer ID Installer' type. Make sure you install it into your System and Login keychains again."}),"\n",(0,o.jsx)(t.h4,{id:"pkg-command",children:"Pkg command"}),"\n",(0,o.jsx)(t.p,{children:"Now run the following command taking note that we are using the installer certificate this time:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'productbuild --sign "Developer ID Installer: ECorp (XXXXXXX)" --component "/path/to/bundle.app" /Applications "/path/to/pkg/to/create/eCorp.pkg" \n'})}),"\n",(0,o.jsx)(t.h3,{id:"notarize-your-pkg-file",children:"Notarize your .pkg file"}),"\n",(0,o.jsxs)(t.p,{children:["If you don't notarize your app users may be unable to install it. As a first step, you'll need to have (or create) an app-specific password for your apple account. This can be done at ",(0,o.jsx)(t.a,{href:"https://appleid.apple.com",children:"https://appleid.apple.com"})," a quick google should help if you need it."]}),"\n",(0,o.jsx)(t.p,{children:"Now we'll upload our pkg file to Apple's notarization service with the following:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'xcrun altool -type osx --notarize-app --primary-bundle-id "com.your.bundle.identifier" --username "your.apple.id@gmail.com" --password "your-app-specific-password" --file "/path/to/pkg/eCorp.pkg"\n'})}),"\n",(0,o.jsx)(t.p,{children:"Nothing will happen for a while as the file is uploaded, eventually, you should get an upload success message. You'll be given a reference string, copy this.\nWait 5-10 minutes then check your email for your rejection email. Apple will say your app wasn't notarized. To find out why we'll need to run the following:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'xcrun altool --notarization-info your-ref-string -u "your.apple.id@gmail.com" --password "your-app-specific-password"\n'})}),"\n",(0,o.jsx)(t.p,{children:"You'll get a response back with a URL for a log file. Throw that into your web browser and you'll see a file explaining your rejection reason. i.e. one of your ANEs wasn't signed. Go back to step 2.5, sign the ANEs and then repeat all subsequent steps and try again."}),"\n",(0,o.jsx)(t.p,{children:"Hopefully, on your next try, you'll get a notarization success email instead."}),"\n",(0,o.jsx)(t.h4,{id:"staple-your-notarization-to-your-pkg-file",children:"Staple your notarization to your pkg file"}),"\n",(0,o.jsx)(t.p,{children:"In order for your app not to require an internet connection to check its notarization status, you should staple the notarization to it. This can be done with:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'xcrun stapler staple -v "/path/to/your/pkg/ECorp.pkg"\n'})}),"\n",(0,o.jsx)(t.p,{children:"You should get a success message and congrats your pkg is ready for distribution."}),"\n",(0,o.jsx)(t.h3,{id:"useful-links",children:"Useful links"}),"\n",(0,o.jsx)(t.p,{children:"The following 2 guides helped me when I got stuck. They have a lot of details but don't quite follow the process that worked for me. Hopefully, they can help if you run into issues."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.a,{href:"https://www.molleindustria.org/blog/notarizing-your-flashair-applications-for-macos/",children:"https://www.molleindustria.org/blog/notarizing-your-flashair-applications-for-macos/"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.a,{href:"https://lessons.livecode.com/m/4071/l/1122100-codesigning-and-notarizing-your-lc-standalone-for-distribution-outside-the-mac-appstore#addendum-2-the-asc-provider",children:"https://lessons.livecode.com/m/4071/l/1122100-codesigning-and-notarizing-your-lc-standalone-for-distribution-outside-the-mac-appstore#addendum-2-the-asc-provider"})})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);